English | [简体中文](./README.zh-CN.md)

# ms-agent

ms-agent is a tool that uses the Go language to write and receive zabbix alarm messages and send them to the [ZbxTable](https://github.com/canghai908/zbxtable) platform. It needs to be used with the ZbxTable platform.

## Compile

``` bash
mkdir -p $GOPATH/src/github.com/canghai908
cd $GOPATH/src/github.com/canghai908
git clone https://github.com/canghai908/ms-agent.git
cd ms-agent
./control build
./control pack
```

## Configuration

The ms-agent deployment needs to be deployed on Zabbix Server. The ms-agent receives zabbix alarm messages and sends them to the ZbxTable platform through the http protocol. Use zbxtable to complete the ms-agent configuration on the zabbix server platform

``` 
cd /usr/local/zbxtable
./zbxtable install
```

The display log is as follows

``` 
2020/07/18 23:22:16.881 [I] [install.go:43]  Zabbix API Address: http://zabbix-server/api_jsonrpc.php
2020/07/18 23:22:16.881 [I] [install.go:44]  Zabbix Admin User: Admin
2020/07/18 23:22:16.881 [I] [install.go:45]  Zabbix Admin Password: xxxxx
2020/07/18 23:22:17.716 [I] [install.go:52]  登录zabbix平台成功!
2020/07/18 23:22:17.879 [I] [install.go:69]  创建告警媒介成功!
2020/07/18 23:22:18.027 [I] [install.go:82]  创建告警用户组成功!
2020/07/18 23:22:18.198 [I] [install.go:113]  创建告警用户成功!
2020/07/18 23:22:18.198 [I] [install.go:114]  用户名:ms-agent
2020/07/18 23:22:18.198 [I] [install.go:115]  密码:xxxx
2020/07/18 23:22:18.366 [I] [install.go:167]  创建告警动作成功!
2020/07/18 23:22:18.366 [I] [install.go:168]  插件安装完成!
```

This step will create ms-agent on Zabbix Server with random password, configure related actions and media, and associate it with users

## Installation

This program must be deployed on Zabbix Server

``` 
yum install https://dl.cactifans.com/zabbix/ms-agent-1.0.1-1.el7.x86_64.rpm -y
```

Environmental information

| program     | path                           | effect                                             |
| :------- | :------------------------------------ | :----------------------------------------------- |
| ms-agent | /usr/lib/zabbix/alertscripts/ms-agent | Receive alarms generated by Zabbix platform and send to ZbxTable platform |
| app.ini  | /etc/ms-agent/app.ini        | ms-agent configuration file                          |

If the alertscripts directory of your Zabbix Server is not /usr/lib/zabbix/alertscripts/, you need to move ms-agen to the alertscripts directory of your zabbix server, otherwise it will appear on the Zabbix alert page that ms-agent cannot be found Error prompt, also unable to receive warning message.
You can also modify the configuration file of Zabbix Server and point the alertscripts directory to /usr/lib/zabbix/alertscripts/

vi zabbix_server.conf

``` 
AlertScriptsPath=/usr/lib/zabbix/alertscripts
```

Restart Zabbix Server after modification to take effect

## Debug

You can modify the configuration file to open the Debug mode, and view the log /tmp/ms-agent_yyyymmdd.log

## License

<img alt="Apache-2.0 license" src="https://s3-gz01.didistatic.com/n9e-pub/image/apache.jpeg" width="128">

Zbxtable is available under the Apache-2.0 license. See the [LICENSE](LICENSE) file for more info.
